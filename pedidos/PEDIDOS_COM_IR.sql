CREATE DATABASE '/home/natanprog/estudos/pedidos/PEDIDOS_COM_IR.FDB'
USER 'SYSDBA' PASSWORD 'Zero2040'
PAGE_SIZE 16384
DEFAULT CHARACTER SET UTF8;

CREATE GENERATOR GEN_CLIENTE_ID START WITH 0 INCREMENT BY 1;
SET GENERATOR GEN_CLIENTE_ID TO 9;

CREATE GENERATOR GEN_FUNCIONARIOS_ID START WITH 0 INCREMENT BY 1;
SET GENERATOR GEN_FUNCIONARIOS_ID TO 19;

CREATE GENERATOR GEN_ITEN_PEDIDO_ID START WITH 0 INCREMENT BY 1;
SET GENERATOR GEN_ITEN_PEDIDO_ID TO 15;

CREATE GENERATOR GEN_PEDIDOS_ID START WITH 0 INCREMENT BY 1;
SET GENERATOR GEN_PEDIDOS_ID TO 12;

CREATE GENERATOR GEN_PRODUTOS_ID START WITH 0 INCREMENT BY 1;
SET GENERATOR GEN_PRODUTOS_ID TO 6;

CREATE TABLE CLIENTE (
    COD_CLI   INTEGER NOT NULL,
    LOJA_CLI  INTEGER NOT NULL,
    NOME      VARCHAR(45) NOT NULL,
    ENDERECO  VARCHAR(45),
    BAIRRO    VARCHAR(30),
    CEP       CHAR(9)
);

CREATE TABLE FUNCIONARIOS (
    COD_FUN  INTEGER NOT NULL,
    NOME     VARCHAR(40) NOT NULL,
    FONE     VARCHAR(25),
    CEP      CHAR(9) DEFAULT '37890-000',
    CPF      CHAR(14)
);

CREATE TABLE ITEN_PEDIDO (
    COD_ITEM     INTEGER NOT NULL,
    COD_PRO      INTEGER NOT NULL,
    COD_PED      INTEGER NOT NULL,
    NOM_PRODUTO  VARCHAR(50) NOT NULL,
    QTDE_ITEN    NUMERIC(10,3) NOT NULL,
    VALOR_ITEN   NUMERIC(9,2) NOT NULL
);

CREATE TABLE PEDIDOS (
    COD_PEDIDO   INTEGER NOT NULL,
    DATA_PEDIDO  DATE NOT NULL,
    VALOR_PAGO   INTEGER,
    COD_CLI      INTEGER NOT NULL,
    LOJA_CLI     INTEGER NOT NULL,
    COD_FUN      INTEGER NOT NULL
);

CREATE TABLE PRODUTOS (
    COD_PROD       INTEGER NOT NULL,
    NOM_PRO        VARCHAR(50) NOT NULL,
    PRECO_VENDA    NUMERIC(9,2) NOT NULL,
    PRECO_COMPRA   NUMERIC(9,2),
    DATA_INCLUSAO  DATE NOT NULL,
    QTDE_ESTOQUE   NUMERIC(10,3)
);

ALTER TABLE CLIENTE ADD CONSTRAINT PK_CLIENTE PRIMARY KEY (COD_CLI, LOJA_CLI);
ALTER TABLE FUNCIONARIOS ADD CONSTRAINT PK_FUNCIONARIOS PRIMARY KEY (COD_FUN);
ALTER TABLE ITEN_PEDIDO ADD CONSTRAINT PK_ITEN_PEDIDO PRIMARY KEY (COD_ITEM);
ALTER TABLE PEDIDOS ADD CONSTRAINT PK_PEDIDOS PRIMARY KEY (COD_PEDIDO);
ALTER TABLE PRODUTOS ADD CONSTRAINT PK_PRODUTOS PRIMARY KEY (COD_PROD);

ALTER TABLE ITEN_PEDIDO ADD CONSTRAINT FK_ITEN_PEDIDO_1 FOREIGN KEY (COD_PRO) REFERENCES PRODUTOS (COD_PROD);
ALTER TABLE ITEN_PEDIDO ADD CONSTRAINT FK_ITEN_PEDIDO_2 FOREIGN KEY (COD_PED) REFERENCES PEDIDOS (COD_PEDIDO) ON DELETE CASCADE;
ALTER TABLE PEDIDOS ADD CONSTRAINT FK_COD_CLI_LOJA_CLI FOREIGN KEY (COD_CLI, LOJA_CLI) REFERENCES CLIENTE (COD_CLI, LOJA_CLI);
ALTER TABLE PEDIDOS ADD CONSTRAINT FK_COD_FUN FOREIGN KEY (COD_FUN) REFERENCES FUNCIONARIOS (COD_FUN);

CREATE UNIQUE INDEX CLIENTE_IDX1 ON CLIENTE (NOME);

SET TERM ^ ;

CREATE TRIGGER CLIENTE_BI FOR CLIENTE
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.COD_CLI IS NULL) THEN
    NEW.COD_CLI = GEN_ID(GEN_CLIENTE_ID,1);
END
^

CREATE TRIGGER FUNCIONARIOS_BI FOR FUNCIONARIOS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.COD_FUN IS NULL) THEN
    NEW.COD_FUN = GEN_ID(GEN_FUNCIONARIOS_ID,1);
END
^

CREATE TRIGGER ITEN_PEDIDO_BI FOR ITEN_PEDIDO
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.COD_ITEM IS NULL) THEN
    NEW.COD_ITEM = GEN_ID(GEN_ITEN_PEDIDO_ID,1);
END
^

CREATE TRIGGER PEDIDOS_BI FOR PEDIDOS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.COD_PEDIDO IS NULL) THEN
    NEW.COD_PEDIDO = GEN_ID(GEN_PEDIDOS_ID,1);
END
^

CREATE TRIGGER PRODUTOS_BI FOR PRODUTOS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.COD_PROD IS NULL) THEN
    NEW.COD_PROD = GEN_ID(GEN_PRODUTOS_ID,1);
END
^
SET TERM ; ^

COMMENT ON TABLE CLIENTE IS
'   Cadastro de Clientes
 Tabela utilizada para Cadastrar os clientes
 para que se associoe os PEDIDOS a cada um deles';

COMMENT ON COLUMN CLIENTE.COD_CLI IS
'Cód. único do cliente';

COMMENT ON COLUMN CLIENTE.LOJA_CLI IS
'Loja que cliente foi incluído';

COMMENT ON COLUMN CLIENTE.NOME IS
'Nome do cliente';

COMMENT ON COLUMN CLIENTE.ENDERECO IS
'Endereço do Cliente';

COMMENT ON COLUMN CLIENTE.BAIRRO IS
'bairro do Cliente';

COMMENT ON COLUMN CLIENTE.CEP IS
'CEP do CLIENTE';

COMMENT ON COLUMN FUNCIONARIOS.COD_FUN IS
'Cód único do funcionário';

COMMENT ON COLUMN PEDIDOS.COD_PEDIDO IS
'Cód único do Pedido';

COMMENT ON COLUMN PEDIDOS.DATA_PEDIDO IS
'Data do Pedido';

COMMENT ON COLUMN PEDIDOS.VALOR_PAGO IS
'Valor JÁ PAGO';

COMMENT ON COLUMN PEDIDOS.COD_CLI IS
'Cód do cliente que comprou';

COMMENT ON COLUMN PEDIDOS.LOJA_CLI IS
'Loja do cliente que fez a compra';

COMMENT ON COLUMN PEDIDOS.COD_FUN IS
'cód do funcionário';

COMMENT ON COLUMN PRODUTOS.COD_PROD IS
'Código do Produto';

COMMENT ON COLUMN PRODUTOS.NOM_PRO IS
'Descrição do Produto';

COMMENT ON COLUMN PRODUTOS.PRECO_VENDA IS
'Preço de Venda';

COMMENT ON COLUMN PRODUTOS.PRECO_COMPRA IS
'Preço de Compra';

COMMENT ON COLUMN PRODUTOS.DATA_INCLUSAO IS
'Data de Inclusão';

INSERT INTO CLIENTE (COD_CLI, LOJA_CLI, NOME, ENDERECO, BAIRRO, CEP) VALUES (1, 1, 'João Maria  ', '', '', '     -                              ');
INSERT INTO CLIENTE (COD_CLI, LOJA_CLI, NOME, ENDERECO, BAIRRO, CEP) VALUES (2, 1, 'Maria José ', '', '', '     -                              ');
INSERT INTO CLIENTE (COD_CLI, LOJA_CLI, NOME, ENDERECO, BAIRRO, CEP) VALUES (3, 1, 'Joaquim Silvério dos Reis', '', '', '     -                              ');
INSERT INTO CLIENTE (COD_CLI, LOJA_CLI, NOME, ENDERECO, BAIRRO, CEP) VALUES (4, 1, 'Antonieta Severo', '', '', '     -                              ');
INSERT INTO CLIENTE (COD_CLI, LOJA_CLI, NOME, ENDERECO, BAIRRO, CEP) VALUES (6, 1, 'José Dirceu', '', '', '     -                              ');

INSERT INTO FUNCIONARIOS (COD_FUN, NOME, FONE, CEP, CPF) VALUES (2, 'Maria das Dores', NULL, '37890-000                           ', '123.456.789-11                                          ');
INSERT INTO FUNCIONARIOS (COD_FUN, NOME, FONE, CEP, CPF) VALUES (13, 'Renata Paulina', NULL, '37890-000                           ', NULL);
INSERT INTO FUNCIONARIOS (COD_FUN, NOME, FONE, CEP, CPF) VALUES (9, 'Fernado da Silvax', NULL, '37890-000                           ', NULL);
INSERT INTO FUNCIONARIOS (COD_FUN, NOME, FONE, CEP, CPF) VALUES (14, 'Adelino Silvério', NULL, '37890-000                           ', NULL);
INSERT INTO FUNCIONARIOS (COD_FUN, NOME, FONE, CEP, CPF) VALUES (17, 'José Antônio', NULL, '37890-000                           ', NULL);
INSERT INTO FUNCIONARIOS (COD_FUN, NOME, FONE, CEP, CPF) VALUES (18, 'Marcelo Nova ', NULL, '37890-000                           ', NULL);

INSERT INTO PEDIDOS (COD_PEDIDO, DATA_PEDIDO, VALOR_PAGO, COD_CLI, LOJA_CLI, COD_FUN) VALUES (7, '2005-12-01', 0, 3, 1, 17);
INSERT INTO PEDIDOS (COD_PEDIDO, DATA_PEDIDO, VALOR_PAGO, COD_CLI, LOJA_CLI, COD_FUN) VALUES (8, '2005-12-11', 0, 2, 1, 17);
INSERT INTO PEDIDOS (COD_PEDIDO, DATA_PEDIDO, VALOR_PAGO, COD_CLI, LOJA_CLI, COD_FUN) VALUES (12, '2005-12-11', 50, 2, 1, 17);
INSERT INTO PEDIDOS (COD_PEDIDO, DATA_PEDIDO, VALOR_PAGO, COD_CLI, LOJA_CLI, COD_FUN) VALUES (10, '2005-12-11', 15, 2, 1, 2);
INSERT INTO PEDIDOS (COD_PEDIDO, DATA_PEDIDO, VALOR_PAGO, COD_CLI, LOJA_CLI, COD_FUN) VALUES (11, '2005-12-05', 10, 2, 1, 2);

INSERT INTO PRODUTOS (COD_PROD, NOM_PRO, PRECO_VENDA, PRECO_COMPRA, DATA_INCLUSAO, QTDE_ESTOQUE) VALUES (1, 'Estante', 15, 16, '2006-01-01', 6);
INSERT INTO PRODUTOS (COD_PROD, NOM_PRO, PRECO_VENDA, PRECO_COMPRA, DATA_INCLUSAO, QTDE_ESTOQUE) VALUES (2, 'Estante de Ferro', 16, 17, '2006-02-01', NULL);
INSERT INTO PRODUTOS (COD_PROD, NOM_PRO, PRECO_VENDA, PRECO_COMPRA, DATA_INCLUSAO, QTDE_ESTOQUE) VALUES (4, 'Jogos de Pratos', 50, 45, '2005-12-10', 10);
INSERT INTO PRODUTOS (COD_PROD, NOM_PRO, PRECO_VENDA, PRECO_COMPRA, DATA_INCLUSAO, QTDE_ESTOQUE) VALUES (5, 'Mesa Cerejeira', 12.5, 13.5, '2005-12-11', 7);
INSERT INTO PRODUTOS (COD_PROD, NOM_PRO, PRECO_VENDA, PRECO_COMPRA, DATA_INCLUSAO, QTDE_ESTOQUE) VALUES (6, 'Computador CELERON', 1450.5, 1234.75, '2005-12-11', NULL);
INSERT INTO PRODUTOS (COD_PROD, NOM_PRO, PRECO_VENDA, PRECO_COMPRA, DATA_INCLUSAO, QTDE_ESTOQUE) VALUES (3, 'PIA', 1, 2, '2006-01-01', 3);

INSERT INTO ITEN_PEDIDO (COD_ITEM, COD_PRO, COD_PED, NOM_PRODUTO, QTDE_ITEN, VALOR_ITEN) VALUES (3, 3, 7, 'PIA', 4, 1);
INSERT INTO ITEN_PEDIDO (COD_ITEM, COD_PRO, COD_PED, NOM_PRODUTO, QTDE_ITEN, VALOR_ITEN) VALUES (4, 4, 8, 'Jogos de Pratos', 2, 50);
INSERT INTO ITEN_PEDIDO (COD_ITEM, COD_PRO, COD_PED, NOM_PRODUTO, QTDE_ITEN, VALOR_ITEN) VALUES (5, 1, 8, 'Produto teste - alterado', 3, 15);
INSERT INTO ITEN_PEDIDO (COD_ITEM, COD_PRO, COD_PED, NOM_PRODUTO, QTDE_ITEN, VALOR_ITEN) VALUES (15, 2, 10, 'Estante de Ferro', 2.5, 16);
INSERT INTO ITEN_PEDIDO (COD_ITEM, COD_PRO, COD_PED, NOM_PRODUTO, QTDE_ITEN, VALOR_ITEN) VALUES (7, 3, 10, 'PIA', 3, 1);
INSERT INTO ITEN_PEDIDO (COD_ITEM, COD_PRO, COD_PED, NOM_PRODUTO, QTDE_ITEN, VALOR_ITEN) VALUES (8, 2, 11, 'Estante de Ferro', 2, 16);
INSERT INTO ITEN_PEDIDO (COD_ITEM, COD_PRO, COD_PED, NOM_PRODUTO, QTDE_ITEN, VALOR_ITEN) VALUES (10, 4, 12, 'Jogos de Pratos', 3, 50);
INSERT INTO ITEN_PEDIDO (COD_ITEM, COD_PRO, COD_PED, NOM_PRODUTO, QTDE_ITEN, VALOR_ITEN) VALUES (11, 5, 12, 'Mesa Cerejeira', 2, 12.5);